# Merge Genie 🧞‍♂️

## Project Overview 💼

**Merge Genie** is an intelligent system designed to help users make informed decisions about mergers and acquisitions (M&A). By entering a company’s stock code, users can receive detailed analysis across multiple dimensions such as risk, efficiency, growth, management, valuation, and financial health. The system synthesizes reports generated by multiple evaluation agents, offering a comprehensive final acquisition recommendation. With the user-friendly Gradio interface, users can easily interact with the tool and retrieve insights.

## Functionality Overview 💡

1. **Stock Code Input and Analysis**:
   - Users input the stock code of the company they wish to analyze.
   - The system retrieves data through custom-built analysis tools and agents.

2. **Multi-Agent Collaboration**:
   - Six specialized agents handle different aspects of company evaluation:
     - **Risk Advisor**: Assesses risks related to the acquisition.
     - **Efficiency Advisor**: Evaluates operational efficiency and its impact on the deal.
     - **Growth Advisor**: Analyzes the growth potential of the target company.
     - **Management Advisor**: Assesses the management team’s performance and strategic alignment.
     - **Valuation Advisor**: Evaluates the company’s financial valuation and whether it justifies the acquisition.
     - **Financial Advisor**: Examines the company’s financial health and its impact on acquisition decisions.

3. **Comprehensive Report Generation**:
   - The system integrates the outputs from all six advisors into a final acquisition recommendation report.
   - This report is generated in English and translated into Japanese for local executive and advisor use.

4. **User-friendly Interface**:
   - The system is accessible via a Gradio interface where users can input stock codes, retrieve analysis reports, and interact with the outputs in real-time.

## Technologies Used 🛠️

### 1. **LangChain** 🚀

The core of **Merge Genie** is powered by **LangChain**, which facilitates multi-agent collaboration, tool usage, and integration with language models to generate meaningful insights. Key aspects of LangChain's implementation include:

- **Custom Tools**: We built multiple custom tools (e.g., `analyze_company_risk`, `analyze_company_efficiency`, etc.) for each evaluation agent. These tools are integrated with LangChain's `Tool` class, allowing each agent to use them for specific tasks.
  
- **Multi-Agent Collaboration**: Each of the six agents is responsible for a different aspect of company evaluation. These agents collaborate through a structured prompt and chain system that is managed by LangChain’s agent orchestration. The agents can exchange information and synthesize their findings into a final comprehensive report.

- **Tool Use and Custom Tool Integration**: The system leverages **LangChain's ToolUseAgent** to execute custom-built tools. These tools interact with external APIs (e.g., financial data sources) and internal datasets, enabling dynamic data retrieval and analysis for risk, efficiency, and other evaluations. The custom tools include advanced prompt engineering and API handling logic to ensure accurate data extraction and processing.

- **LLM Chains**: 
  - The **LLMChain** structure allows each advisor to generate detailed analysis based on structured prompts. For example, a **Risk Advisor** uses risk-related prompts to analyze the company's exposure to risk factors. Each agent operates independently but shares information with the final report generator, which synthesizes the data.
  - The **generate_report_chain** creates a comprehensive acquisition recommendation based on synthesized outputs from the individual agents.
  
- **Translation with LLMChain**: After the report is generated in English, a separate **LLMChain** is responsible for translating the final report into Japanese. This process uses financial terminology and is guided by precise prompts to ensure the translation is accurate and suited for Japanese business executives.

### 2. **OpenAI GPT-4o-mini** 🤖
   - **Merge Genie** uses `ChatOpenAI` with the `gpt-4o-mini` model to power the language understanding and report generation. The model processes user inputs, generates detailed analysis, and synthesizes information from various agents into coherent reports.
   - The system uses `gpt-4o-mini` to handle complex business language and provide precise recommendations.

### 3. **Custom-Built Analysis Agents** 🔧
   - Each advisor is a custom-built tool responsible for a specific aspect of the company’s evaluation. These tools are invoked via `LangChain's ToolUseAgent`, which allows them to communicate with external APIs, run internal algorithms, and handle advanced prompt-based operations.
   - Examples include `analyze_company_risk`, `analyze_company_efficiency`, and `analyze_company_finance`.

### 4. **Gradio Interface** 💻
   - The front-end of **Merge Genie** is powered by `Gradio`, providing a clean and simple user interface. Users can input stock codes, click the analyze button, and view detailed reports across multiple categories (e.g., Risk, Efficiency, Growth, etc.).
   - The interface supports real-time feedback and displays reports as they are generated.

### 5. **Concurrency with ThreadPoolExecutor** ⚙️
   - To improve performance, **Merge Genie** uses Python’s `concurrent.futures.ThreadPoolExecutor` to parallelize the evaluation tasks performed by each agent. This allows multiple agents to run simultaneously, significantly speeding up the report generation process.

### 6. **Markdown Report Generation and Translation** 📄
   - The final acquisition recommendation report is generated in **Markdown** format, making it easy to read, share, and integrate into corporate documents.
   - The system translates the report into Japanese using LangChain's language model, ensuring clarity and accuracy for local stakeholders.

---

#### 2024/9/15 Tool Formatting and Removal
![WEBUIインターフェース](./images/web_ui.png)
Tool formatting has been removed for stability.


## Japanese Report Links

- [(Example) Fujifilm Final Report (Japanese)](./result/4901.T/Final/4901.T_final_report_japanese.md)
## Usage

1. Install the necessary libraries:
   
   ```
   pip install -r requirements.txt
   ```

2. Run`Merge_Genie.py` to start the Web UI::
   ```
   python Merge_Genie.py
   ```

3. Access the URL displayed in your browser.

4. Enter the stock code you want to analyze in the Web UI and click the "Analyze" button (e.g., for Fujifilm, enter 4901.T).

## Workflow
The following steps describe the workflow:

1. **Enter Stock Code**: The user enters the stock code they want to analyze.
2. **Agent Invocation**: Six agents use their respective tools to gather data and perform analysis.
- Risk Evaluation Agent
- Efficiency Evaluation Agent
- Growth Evaluation Agent
- Management Evaluation Agent
- Valuation Evaluation Agent
- Financial Evaluation Agent
3. **Report Generation**: Each agent generates reports in English and Japanese (Japanese reports are translated by LLMChain) and saves them in their respective folders.
4. **Final Report Creation**: Finally, a FINAL_REPORT is generated in the stock code/final folder, providing M&A advice to the user.

# Additional Features to Implement if Time Permits
**1. Utilizing RAG**: Synergy analysis during acquisition (analyzing together with the company's information database)  
**2. Implementing Calculation Tools**: Using the DCF method for company valuation  
**3. Graphing Analysis Results**  
**4. Using Financial LLM Models**  

## Agent Workflow

```mermaid
graph TD;
 A[Enter Stock Code] --> B[Risk Evaluation Agent]
 A --> C[Efficiency Evaluation Agent]
 A --> D[Growth Evaluation Agent]
 A --> E[Management Evaluation Agent]
 A --> F[Valuation Evaluation Agent]
 A --> G[Financial Evaluation Agent]
 B --> H[Save Risk English Report]
 B --> I[Save Risk Japanese Report]
 C --> J[Save Efficiency English Report]
 C --> K[Save Efficiency Japanese Report]
 D --> L[Save Growth English Report]
 D --> M[Save Growth Japanese Report]
 E --> N[Save Management English Report]
 E --> O[Save Management Japanese Report]
 F --> P[Save Valuation English Report]
 F --> Q[Save Valuation Japanese Report]
 G --> R[Save Financial English Report]
 G --> S[Save Financial Japanese Report]
 H --> T[Create Final English Report]
 J --> T
 L --> T
 N --> T
 P --> T
 R --> T
 T --> U[Translate Final English Report to Japanese]
 U --> V[Save Final Japanese Report]
